// Copyright Tempo Simulation, LLC. All Rights Reserved

syntax = "proto3";

import "TempoScripting/Geometry.proto";

// Collision channel for physics queries
enum CollisionChannel {
  WORLD_STATIC = 0;
  WORLD_DYNAMIC = 1;
  VISIBILITY = 2;
}

// Raycast request for physics queries
message RaycastRequest {
  // Start position (in Tempo coordinates: meters, right-handed)
  TempoScripting.Vector start = 1;

  // End position (in Tempo coordinates: meters, right-handed)
  TempoScripting.Vector end = 2;

  // Collision channel to use
  CollisionChannel collision_channel = 3;

  // Actor names to ignore
  repeated string ignored_actors = 4;
}

// Raycast response
message RaycastResponse {
  // Whether the ray hit something
  bool hit = 1;

  // Hit location (in Tempo coordinates: meters, right-handed)
  TempoScripting.Vector location = 2;

  // Hit normal (in Tempo coordinates)
  TempoScripting.Vector normal = 3;

  // Distance from start to hit point (in meters)
  float distance = 4;

  // Name of the actor that was hit
  string actor = 5;

  // Name of the component that was hit
  string component = 6;
}

message OverlapEventRequest {
  string actor_name = 1;
}

message OverlapEventResponse {
  string overlapped_actor_name = 1;
  string other_actor_name = 2;
  string other_actor_type = 3;
}

message ActorStateRequest {
  string actor_name = 1;
  bool include_hidden_components = 2;
}

message ActorStatesNearRequest {
  string near_actor_name = 1;
  float search_radius = 2;
  bool include_static = 3;
  bool include_hidden_actors = 4;
  bool include_hidden_components = 5;
}

message ActorState {
  double timestamp = 1;
  string name = 2;
  TempoScripting.Transform transform = 3;
  TempoScripting.Vector linear_velocity = 4;
  TempoScripting.Vector angular_velocity = 5;
  TempoScripting.Box bounds = 6;
}

message ActorStates {
  repeated ActorState actor_states = 1;
}

service WorldStateService {
  rpc StreamOverlapEvents(OverlapEventRequest) returns (stream OverlapEventResponse);

  rpc GetCurrentActorState(ActorStateRequest) returns (ActorState);

  rpc StreamActorState(ActorStateRequest) returns (stream ActorState);

  rpc GetCurrentActorStatesNear(ActorStatesNearRequest) returns (ActorStates);

  rpc StreamActorStatesNear(ActorStatesNearRequest) returns (stream ActorStates);

  // Perform a single raycast
  rpc Raycast(RaycastRequest) returns (RaycastResponse);
}
